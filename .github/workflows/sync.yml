name: Mirror from cli/go

on:
  workflow_dispatch:         # allow manual trigger
    inputs:
      sha:
        type: string
        required: true

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout mirror repo (cli-go)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Pull latest cli repo
        run: |
          git clone https://github.com/ahqstore/cli.git ../cli
          cd ../cli
          git fetch origin ${{ inputs.sha }}

      - name: Sync cli/go â†’ cli-go/ahqstore
        run: |
          mkdir -p ahqstore
          rsync -av --delete ../cli/go/ ahqstore/
          git add ahqstore
          if git diff --cached --quiet; then
            echo "No changes to commit"
          else
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git commit -m "Mirror update from cli/go"
            git push
          fi
